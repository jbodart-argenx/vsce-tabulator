<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Tabulator Table</title>
      <script src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.min.js"></script>
      <link
         href="https://unpkg.com/tabulator-tables@4.9.3/dist/css/tabulator.min.css"
         rel="stylesheet"
      />
      <style>
         body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            padding: 0;
         }
         #header {
            flex: 0 0 auto;
            padding: 10px;
            background-color: #f0f0f0;
            border-bottom: 1px solid #ccc;
         }
         #tabulator-table {
            flex: 1 1 auto;
            overflow-y: auto;
         }
      </style>
      <style id="dynamic-styles"></style>
   </head>
   <body>
      <div id="header">
         <button id="requestDataButton">Request Data</button>
      </div>
      <div id="tabulator-table"></div>
      <script>
         const vscode = acquireVsCodeApi();

         const table = new Tabulator("#tabulator-table", {
            columns: [
               { title: "Name", field: "name" },
               { title: "Progress", field: "progress" },
               { title: "Gender", field: "gender" },
               { title: "Rating", field: "rating" },
               { title: "Color", field: "col" },
               { title: "Date of Birth", field: "dob" },
               { title: "Car", field: "car" },
            ],
            height: "100%", // set height of table
            movableColumns: true, // allow column order to be changed
            resizableRows: true, // allow row height to be changed
            autoColumns: true, // create columns from data field names
         });

         // Function to apply custom scrollbar styles
         function applyCustomScrollbarStyles() {
            const tableHolder = document.querySelector(
               ".tabulator-tableHolder"
            );
            if (tableHolder) {
               // Apply custom scrollbar styles for Firefox
               tableHolder.style.scrollbarWidth = "thin";
               tableHolder.style.scrollbarColor =
                  "rgba(136, 136, 255, 0.5) rgba(255, 136, 136, 0.5)";

               // Access the pre-existing style element
               const style = document.getElementById("dynamic-styles");
               style.textContent = `
                  .tabulator-tableHolder::-webkit-scrollbar {
                        width: 4px !important;
                        height: 4px !important;
                  }
                  .tabulator-tableHolder::-webkit-scrollbar-track {
                        background: transparent !important;
                  }
                  .tabulator-tableHolder::-webkit-scrollbar-thumb {
                        background: rgba(136, 136, 136, 0.5) !important;
                        border-radius: 2px !important;
                  }
                  .tabulator-tableHolder::-webkit-scrollbar-thumb:hover {
                        background: rgba(85, 85, 85, 0.5) !important;
                  }
                  .tabulator-tableHolder::-webkit-scrollbar-button {
                        display: none !important; /* Hide buttons if not needed */
                  }
               `;
            }
         }

         // Handle messages from extension script
         window.addEventListener("message", (event) => {
            const message = event.data;
            switch (message.command) {
               case "updateData":
                  table.setData(message.data);
                  // Apply custom scrollbar styles dynamically after setting data
                  applyCustomScrollbarStyles();
                  break;
            }
         });

         // Send requestData message to extension when button is clicked
         document
            .getElementById("requestDataButton")
            .addEventListener("click", () => {
               vscode.postMessage({ command: "requestData" });
            });

         // Apply custom scrollbar styles after table initialization
         applyCustomScrollbarStyles();
      </script>
   </body>
</html>
